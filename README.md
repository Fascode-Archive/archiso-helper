# archiso-builder
ArchISOの補助を行います。デフォルト設定で最新のLiveCDをビルドすることもできます。  
~~（もともとは最新のCDをビルドするためだったんだが...）~~  
↑のスクリプトはarchlinux-builder-mini.shです。  
永遠のalpha版、安定版なんてなかった。（Release1では「完成」となっていますが、実際には多くのバグがあるのでarchlinux-builder-mini.shを使用することをおすすめします。）  


# 現在無効化されている機能
- i686のビルドは現在無効化されており、強制的にx86_64がビルドされます



# 現在わかっているバグ
複数回実行していると成功する場合があり、原因がわかっていません。
- 初回実行時のみ、build.shが見つからない場合があります。2回目以降でこのバグが起きたことはありません。 



# 注意事項
- ビルドに失敗する場合はもう一度実行してみてください  
- customize_airootfs.shの実行後にエラーが出る場合は、再起動するとビルドできる場合があります。  
- カーネルを更新後、再起動していない状態で（古いカーネルを実行したまま）ビルドを開始するとエラーが出ます。必ずインストールされているカーネルと実行中のカーネルを一致させてください。  
- 設定には干渉する値もあります。十分に注意して設定してください。  
- スクリプトはRootユーザーが書き込み権限のあるディレクトリで実行する必要があります。  
- カスタムリポジトリのディレクトリはAURユーザーの書き込み権限のあるディレクトリを指定する必要があります。
- このスクリプトはArchLinuxでのみテストされています。ManjaroなどのArch系列で実行する場合はディストリビューションチェックをコメントアウトしてください。

# 実行方法
デフォルトでは/home/直下にarchlinux-hogehoge-x86_64.isoで作成されます。

```bash
wget -q https://0e0.pw/bFSJ
chmod +x start_build.bash
./start_build.bash
```

# 追加のファイルについて
settings.bashやbuild_i686.shは必須ではありません。  

## start_build.bash
このファイルはビルドする際のランチャーとなるものです。  
必要なファイルを自動でダウンロード、実行します。  
スクリプト内部では、設定ファイルへのURLを指定できます。  
実行するたびにダウンロードを行うので常に最新の状態で利用できます。　　


## settings.bash
設定を記述したファイルです。archlinux_builder.bashを更新した際に設定を保存できるファイルです。  
引数として設定ファイルへのパスを指定することができます。  
`simple`ブランチのものは他のバージョンと互換性がありません。


## archlinux-builder-mini.sh
ArchLinuxの純粋なLiveCDを生成します。（これが本来作りたかったスクリプト）  
生成時の最新のパッケージをそのままイメージファイルにします。

```bash
./aur.bash hogehoge fugafuga
```

## mkarchiso-jp-bar.patch
ArchISOの本体であるmkarchisoへパッチを行うものです。  
このパッチはmkarchisoにて以下のことを可能にします。  
- pacman等のメッセージの日本語化  
- squashfsのバーの表示  
パッチは以下のコマンドで適用できます。

```bash
sudo patch < mkarchiso-jp-bar.patch
```

パッチを適用前に戻すには以下のコマンドを実行してください。

```bash
sudo patch -R -u < mkarchiso-jp-bar.patch
```


# i686
現在は対応しておりません。

# 設定
設定はsettings.bashで設定することが推奨されています。  
（スクリプト内で設定することも可能です。）  
設定はスクリプト内に細かく書かれています。  


